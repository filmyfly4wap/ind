<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Professional DRM Player with Quality Control</title>

  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

  <style>
    body {
      background: #000;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: sans-serif;
    }

    .container {
      width: 100%;
      max-width: 900px;
      position: relative;
    }

    :root {
      --plyr-color-main: #ff0000;
    }

    /* Theme color Red */
    .live-tag {
      position: absolute;
      top: 15px;
      left: 15px;
      background: red;
      color: white;
      padding: 2px 10px;
      border-radius: 3px;
      font-size: 12px;
      font-weight: bold;
      z-index: 2;
    }
  </style>
</head>

<body>

  <div class="container">
    <div class="live-tag">â— LIVE</div>
    <video id="videoPlayer" playsinline crossorigin></video>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const video = document.querySelector('#videoPlayer');
      const mpdUrl =
        "https://jiotvpllive.cdn.jio.com/bpk-tv/Star_Sports_HD1_Hindi_BTS/output/index.mpd";

      // DRM Keys
      const keyId = "400131994b445d8c8817202248760fda";
      const key = "2d56cb6f07a75b9aff165d534ae2bfc4";

      // 1. Initialize Dash.js
      const dashPlayer = dashjs.MediaPlayer().create();
      dashPlayer.setProtectionData({
        "org.w3.clearkey": {
          "clearkeys": {
            [keyId]: key
          }
        }
      });

      dashPlayer.initialize(video, mpdUrl, true);

      // 2. Setup Plyr
      const player = new Plyr(video, {
        controls: ['play-large', 'play', 'progress', 'current-time',
          'mute', 'volume', 'settings', 'pip', 'fullscreen'
        ],
        settings: ['quality', 'speed'],
        autoplay: true
      });

      // 3. Quality Selection Logic
      dashPlayer.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED,
    function() {
        const availableQualities = dashPlayer.getBitrateInfoListFor(
          'video');

        // Quality levels ko Plyr format mein convert karna
        const qualities = availableQualities.map((item) => item.height);

        // Quality update config
        player.config.quality = {
          default: qualities[qualities.length - 1], // Default highest
          options: qualities,
          forced: true,
          onChange: (newQuality) => {
            availableQualities.forEach((item) => {
              if (item.height === newQuality) {
                dashPlayer.setQualityFor('video', item.index);
              }
            });
          },
        };
      });

      // Handle Autoplay Block (Browsers often block sound-on autoplay)
      dashPlayer.on(dashjs.MediaPlayer.events.CAN_PLAY, () => {
        video.muted = true; // Safe side ke liye muted
        video.play();
      });

      // Link dash.js to Plyr
      window.player = player;
      window.dashPlayer = dashPlayer;
    });
  </script>

</body>

</html>
